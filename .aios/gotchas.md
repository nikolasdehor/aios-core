# Known Gotchas

> Auto-generated from session insights
> Last updated: 2026-01-29T03:31:04.348Z
> Total gotchas: 4

This document contains common pitfalls and their solutions discovered during development.
Each gotcha includes the **wrong** approach, the **right** approach, and the **reason** why.

---

## Table of Contents

- [State Management](#state-management) (1)
- [API](#api) (2)
- [Other](#other) (1)

---

## State Management

### Zustand Persist Type Inference

**[MEDIUM]**

**Wrong:**

```typescript
const useStore = create(
  persist((set) => ({ ... }), { name: 'store' })
);
```

**Right:**

```typescript
const useStore = create<StoreType>()(
  persist((set) => ({ ... }), { name: 'store' })
);
```

**Reason:** Without explicit type parameter and extra parentheses, TypeScript cannot infer the store type correctly.

**Severity:** Medium

**Discovered:** STORY-7.4-TEST (2026-01-29)

**Related Files:** src/stores/authStore.ts

---

## API

### Fetch Error Handling

**[HIGH]**

**Wrong:**

```typescript
const data = await fetch(url).then((r) => r.json());
```

**Right:**

```typescript
const response = await fetch(url);
if (!response.ok) {
  throw new Error(`HTTP ${response.status}`);
}
const data = await response.json();
```

**Reason:** fetch() doesn't throw on HTTP errors (4xx, 5xx), only on network failures.

**Severity:** High

**Discovered:** STORY-7.4-TEST (2026-01-29)

**Related Files:** src/lib/api.ts

---

### Zustand persist middleware requires async hydration - com...

**[HIGH]**

**Reason:** Zustand persist middleware requires async hydration - common pitfall is to not wait for hydration

**Severity:** High

**Discovered:** STORY-7.4-TEST (2026-01-29)

**Related Files:** src/stores/authStore.ts

---

## Other

### React useEffect Cleanup

**[HIGH]**

**Wrong:**

```typescript
useEffect(() => {
  fetchData();
}, [id]);
```

**Right:**

```typescript
useEffect(() => {
  let cancelled = false;
  const fetch = async () => {
    const data = await fetchData();
    if (!cancelled) setData(data);
  };
  fetch();
  return () => {
    cancelled = true;
  };
}, [id]);
```

**Reason:** Without cleanup, race conditions can occur when the component unmounts or dependencies change before the async operation completes.

**Severity:** High

**Discovered:** STORY-7.4-TEST (2026-01-29)

---

---

## Statistics

| Metric            | Value |
| ----------------- | ----- |
| Total Gotchas     | 4     |
| Categories        | 3     |
| Insights Scanned  | 1     |
| Duplicates Merged | 0     |

---

_Generated by AIOS Gotchas Documenter v1.0.0_
